{"version":3,"file":"routeMatch.js","sources":["../../src/routeMatch.ts"],"sourcesContent":["import { Store } from '@tanstack/store'\n//\nimport { GetFrameworkGeneric } from './frameworks'\nimport { AnyRoute, AnySearchSchema, Route } from './route'\nimport { AnyRoutesInfo, DefaultRoutesInfo } from './routeInfo'\nimport { AnyRouter, isRedirect, ParsedLocation, Router } from './router'\nimport { Expand, pick, replaceEqualDeep } from './utils'\n\nexport interface RouteMatchStore<\n  TRoutesInfo extends AnyRoutesInfo = DefaultRoutesInfo,\n  TRoute extends AnyRoute = Route,\n> {\n  routeSearch: TRoute['__types']['searchSchema']\n  search: TRoutesInfo['fullSearchSchema'] &\n    TRoute['__types']['fullSearchSchema']\n  status: 'idle' | 'pending' | 'success' | 'error'\n  error?: unknown\n  updatedAt: number\n}\n\nconst componentTypes = [\n  'component',\n  'errorComponent',\n  'pendingComponent',\n] as const\n\nexport interface PendingRouteMatchInfo {\n  state: RouteMatchStore<any, any>\n  routeContext: {}\n  context: {}\n}\n\nexport interface AnyRouteMatch extends RouteMatch<any, any> {}\n\nexport class RouteMatch<\n  TRoutesInfo extends AnyRoutesInfo = DefaultRoutesInfo,\n  TRoute extends AnyRoute = AnyRoute,\n> {\n  route!: TRoute\n  router!: Router<TRoutesInfo['routeTree'], TRoutesInfo>\n  __store!: Store<RouteMatchStore<TRoutesInfo, TRoute>>\n  state!: RouteMatchStore<TRoutesInfo, TRoute>\n  id!: string\n  pathname!: string\n  params!: TRoute['__types']['allParams']\n\n  routeContext?: TRoute['__types']['routeContext']\n  context?: TRoute['__types']['context']\n\n  component?: GetFrameworkGeneric<'Component'>\n  errorComponent?: GetFrameworkGeneric<'ErrorComponent'>\n  pendingComponent?: GetFrameworkGeneric<'Component'>\n  abortController = new AbortController()\n  parentMatch?: RouteMatch\n  pendingInfo?: PendingRouteMatchInfo\n\n  __loadPromise?: Promise<void>\n  __onExit?:\n    | void\n    | ((matchContext: {\n        params: TRoute['__types']['allParams']\n        search: TRoute['__types']['fullSearchSchema']\n      }) => void)\n\n  constructor(\n    router: AnyRouter,\n    route: TRoute,\n    opts: {\n      id: string\n      params: TRoute['__types']['allParams']\n      pathname: string\n    },\n  ) {\n    Object.assign(this, {\n      route,\n      router,\n      id: opts.id,\n      pathname: opts.pathname,\n      params: opts.params,\n      __store: new Store<RouteMatchStore<TRoutesInfo, TRoute>>(\n        {\n          updatedAt: 0,\n          routeSearch: {},\n          search: {} as any,\n          status: 'idle',\n        },\n        {\n          onUpdate: (next) => {\n            this.state = next\n          },\n        },\n      ),\n    })\n\n    this.state = this.__store.state\n\n    componentTypes.map(async (type) => {\n      const component = this.route.options[type]\n\n      if (typeof this[type] !== 'function') {\n        this[type] = component\n      }\n    })\n\n    if (this.state.status === 'idle' && !this.#hasLoaders()) {\n      this.__store.setState((s) => ({\n        ...s,\n        status: 'success',\n      }))\n    }\n  }\n\n  #hasLoaders = () => {\n    return !!(\n      this.route.options.onLoad ||\n      componentTypes.some((d) => this.route.options[d]?.preload)\n    )\n  }\n\n  __commit = () => {\n    const { routeSearch, search, context, routeContext } = this.#resolveInfo({\n      location: this.router.state.currentLocation,\n    })\n    this.context = context\n    this.routeContext = routeContext\n    this.__store.setState((s) => ({\n      ...s,\n      routeSearch: replaceEqualDeep(s.routeSearch, routeSearch),\n      search: replaceEqualDeep(s.search, search),\n    }))\n  }\n\n  cancel = () => {\n    this.abortController?.abort()\n  }\n\n  #resolveSearchInfo = (opts: {\n    location: ParsedLocation\n  }): { routeSearch: {}; search: {} } => {\n    // Validate the search params and stabilize them\n    const parentSearchInfo = this.parentMatch\n      ? this.parentMatch.#resolveSearchInfo(opts)\n      : { search: opts.location.search, routeSearch: opts.location.search }\n\n    try {\n      const validator =\n        typeof this.route.options.validateSearch === 'object'\n          ? this.route.options.validateSearch.parse\n          : this.route.options.validateSearch\n\n      const routeSearch = validator?.(parentSearchInfo.search) ?? {}\n\n      const search = {\n        ...parentSearchInfo.search,\n        ...routeSearch,\n      }\n\n      return {\n        routeSearch,\n        search,\n      }\n    } catch (err: any) {\n      if (isRedirect(err)) {\n        throw err\n      }\n\n      const errorHandler = this.route.options.onValidateSearchError ?? this.route.options.onError\n      errorHandler?.(err)\n      const error = new (Error as any)('Invalid search params found', {\n        cause: err,\n      })\n      error.code = 'INVALID_SEARCH_PARAMS'\n\n      throw error\n    }\n  }\n\n  #resolveInfo = (opts: { location: ParsedLocation }) => {\n    const { search, routeSearch } = this.#resolveSearchInfo(opts)\n\n    try {\n      const routeContext =\n        this.route.options.getContext?.({\n          parentContext: this.parentMatch?.routeContext ?? {},\n          context:\n            this.parentMatch?.context ?? this.router?.options.context ?? {},\n          params: this.params,\n          search,\n        }) || ({} as any)\n\n        const context = {\n          ...(this.parentMatch?.context ?? this.router?.options.context),\n          ...routeContext,\n        } as any\n    \n        return {\n          routeSearch,\n          search,\n          context,\n          routeContext,\n        }\n    } catch (err) {\n      this.route.options.onError?.(err)\n      throw err\n    }\n  }\n\n  __load = async (opts: {\n    parentMatch: RouteMatch | undefined\n    preload?: boolean\n    location: ParsedLocation\n  }): Promise<void> => {\n    this.parentMatch = opts.parentMatch\n\n    let info\n\n    try {\n      info = this.#resolveInfo(opts)\n    } catch (err) {\n      if (isRedirect(err)) {\n        if (!opts?.preload) {\n          this.router.navigate(err as any)\n        }\n        return\n      }\n\n      this.__store.setState((s) => ({\n        ...s,\n        status: 'error',\n        error: err,\n      }))\n\n      // Do not proceed with loading the route\n      return\n    }\n\n    const { routeSearch, search, context, routeContext } = info\n\n    // If the match is invalid, errored or idle, trigger it to load\n    if (this.state.status === 'pending') {\n      return\n    }\n\n    // TODO: Should load promises be tracked based on location?\n    this.__loadPromise = Promise.resolve().then(async () => {\n      const loadId = '' + Date.now() + Math.random()\n      this.#latestId = loadId\n\n      const checkLatest = () => {\n        return loadId !== this.#latestId ? this.__loadPromise : undefined\n      }\n\n      let latestPromise\n\n      // If the match was in an error state, set it\n      // to a loading state again. Otherwise, keep it\n      // as loading or resolved\n      if (this.state.status === 'idle') {\n        this.__store.setState((s) => ({\n          ...s,\n          status: 'pending',\n        }))\n      }\n\n      const componentsPromise = (async () => {\n        // then run all component and data loaders in parallel\n        // For each component type, potentially load it asynchronously\n\n        await Promise.all(\n          componentTypes.map(async (type) => {\n            const component = this.route.options[type]\n\n            if (this[type]?.preload) {\n              this[type] = await this.router.options.loadComponent!(component)\n            }\n          }),\n        )\n      })()\n\n      const dataPromise = Promise.resolve().then(() => {\n        if (this.route.options.onLoad) {\n          return this.route.options.onLoad({\n            params: this.params,\n            routeSearch,\n            search,\n            signal: this.abortController.signal,\n            preload: !!opts?.preload,\n            routeContext: routeContext,\n            context: context,\n          })\n        }\n        return\n      })\n\n      try {\n        await Promise.all([componentsPromise, dataPromise])\n        if ((latestPromise = checkLatest())) return await latestPromise\n        this.__store.setState((s) => ({\n          ...s,\n          error: undefined,\n          status: 'success',\n          updatedAt: Date.now(),\n        }))\n      } catch (err) {\n        if (isRedirect(err)) {\n          if (!opts?.preload) {\n            this.router.navigate(err as any)\n          }\n          return\n        }\n\n        const errorHandler = this.route.options.onLoadError ?? this.route.options.onError\n        try {\n          errorHandler?.(err)\n        } catch (errorHandlerErr) {\n          if (isRedirect(errorHandlerErr)) {\n            if (!opts?.preload) {\n              this.router.navigate(errorHandlerErr as any)\n            }\n            return\n          }\n\n          this.__store.setState((s) => ({\n            ...s,\n            error: errorHandlerErr,\n            status: 'error',\n            updatedAt: Date.now(),\n          }))\n          return\n        }\n\n        this.__store.setState((s) => ({\n          ...s,\n          error: err,\n          status: 'error',\n          updatedAt: Date.now(),\n        }))\n      } finally {\n        delete this.__loadPromise\n      }\n    })\n\n    return this.__loadPromise\n  }\n\n  #latestId = ''\n}\n"],"names":["componentTypes","RouteMatch","abortController","AbortController","constructor","router","route","opts","Object","assign","id","pathname","params","__store","Store","updatedAt","routeSearch","search","status","onUpdate","next","state","map","type","component","options","setState","s","onLoad","some","d","preload","__commit","context","routeContext","location","currentLocation","replaceEqualDeep","cancel","abort","parentSearchInfo","parentMatch","validator","validateSearch","parse","err","isRedirect","errorHandler","onValidateSearchError","onError","error","Error","cause","code","getContext","parentContext","__load","info","navigate","__loadPromise","Promise","resolve","then","loadId","Date","now","Math","random","checkLatest","undefined","latestPromise","componentsPromise","all","loadComponent","dataPromise","signal","onLoadError","errorHandlerErr"],"mappings":"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"}